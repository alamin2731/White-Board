<!DOCTYPE html>
<html>

<head>
    <title>Interactive Whiteboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <style>
        #whiteboard {
            border: 1px solid black;
            background-color: white;
            cursor: crosshair;
            top: 0;
            width: 100%;
            height: 800px;
        }

        #controls {
            position: fixed;
            top: 0;
            left: 0;
            background-color: #5cb55c;
            padding: 10px;
            width: 100%;
            display: flex;
            align-items: center;
        }

        #shapeButtons {
            display: flex;
            
        }

        .shapeButton {
            border: 2px solid rgb(131, 51, 7);
            background-color: transparent;
            cursor: pointer;
            margin-right: 15px;


        }

        .selected {
            background-color: #430fc8;
        }

        .hidden {
            display: none;
        }

        #intensitySlider {
            width: 100px;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <div id="controls">
        <div id="shapeButtons">
            <button class="shapeButton btn btn-primary" id="freeBtn" title="Free Writing">
                <i class="fa-solid fa-pen-fancy"></i>
            </button>
            <button class="shapeButton btn btn-primary" id="lineBtn" title="Line">
                <i class="fas fa-pencil-alt"></i>
            </button>
            <button class="shapeButton btn btn-primary" id="circleBtn" title="Circle">
                <i class="fa-regular fa-circle"></i>
            </button>
            <button class="shapeButton btn btn-primary" id="squareBtn" title="Square">
                </i><i class="fa-regular fa-square"></i>
            </button>
           
            <button class="shapeButton btn btn-primary" id="triangleBtn" title="Triangle">
                <i class="fas fa-play"></i><i class="fa-light fa-triangle"></i>
            </button>
        </div>

        <div class="">
            <label for="colorSelect"></label>
            <input type="color" id="colorSelect">

            <label for="intensitySlider">Ink Intensity:</label>
            <input type="range" id="intensitySlider" min="1" max="5" value="2">

            <button id="clearBtn" type="button" class=" shapeButton btn btn-danger">Clear All</button>
            <button id="saveBtn" type="button" class="shapeButton btn btn-outline-success">Save</button>
            <button id="undoBtn" type="button" class=" shapeButton btn btn-outline-warning">Undo</button>
            <input type="file" id="loadBtn" accept="image/png" class="hidden">
        </div>


    </div>
    <canvas id="whiteboard"></canvas>

    <script>
        // Initialize the whiteboard
        var whiteboard = document.getElementById("whiteboard");
        var context = whiteboard.getContext("2d");
        context.lineWidth = 2;
        var shapes = [];
        var isDrawing = false;
        var selectedShapeButton = null;

        // Event listeners for drawing
        whiteboard.addEventListener("mousedown", startDrawing);
        whiteboard.addEventListener("mousemove", draw);
        whiteboard.addEventListener("mouseup", stopDrawing);
        whiteboard.addEventListener("mouseout", stopDrawing);

        // Resize the canvas to match the device window
        function resizeCanvasToWindow() {
            whiteboard.width = window.innerWidth;
            whiteboard.height = window.innerHeight;
            redraw();
        }

        // Attach resize event listener to window
        window.addEventListener("resize", resizeCanvasToWindow);

        // Call the resize function initially
        resizeCanvasToWindow();

        function startDrawing(e) {
            isDrawing = true;
            shapes.push({
                shape: selectedShapeButton.id,
                color: document.getElementById("colorSelect").value,
                intensity: getInkIntensity(),
                points: [{ x: e.offsetX, y: e.offsetY }]
            });
        }

        function draw(e) {
            if (!isDrawing) return;

            var currentShape = shapes[shapes.length - 1];
            currentShape.points.push({ x: e.offsetX, y: e.offsetY });

            redraw();
        }

        function redraw() {
            context.clearRect(0, 0, whiteboard.width, whiteboard.height);

            shapes.forEach(shape => {
                context.beginPath();

                switch (shape.shape) {
                    case "lineBtn":
                        // Draw line shape
                        context.moveTo(shape.points[0].x, shape.points[0].y);
                        context.lineTo(
                            shape.points[shape.points.length - 1].x,
                            shape.points[shape.points.length - 1].y
                        );
                        break;
                    case "circleBtn":
                        // Draw circle shape
                        var radius = Math.sqrt(
                            Math.pow(shape.points[0].x - shape.points[shape.points.length - 1].x, 2) +
                            Math.pow(shape.points[0].y - shape.points[shape.points.length - 1].y, 2)
                        );
                        context.arc(shape.points[0].x, shape.points[0].y, radius, 0, Math.PI * 2);
                        break;
                    case "squareBtn":
                        // Draw square shape
                        var width = Math.abs(shape.points[0].x - shape.points[shape.points.length - 1].x);
                        var height = Math.abs(shape.points[0].y - shape.points[shape.points.length - 1].y);
                        context.rect(shape.points[0].x, shape.points[0].y, width, height);
                        break;
                    case "freeBtn":
                        // Draw free writing shape
                        context.moveTo(shape.points[0].x, shape.points[0].y);
                        for (var i = 1; i < shape.points.length; i++) {
                            context.lineTo(shape.points[i].x, shape.points[i].y);
                        }
                        break;
                    case "triangleBtn":
                        // Draw triangle shape
                        context.moveTo(shape.points[0].x, shape.points[0].y);
                        context.lineTo(
                            shape.points[shape.points.length - 1].x,
                            shape.points[shape.points.length - 1].y
                        );
                        context.lineTo(shape.points[0].x, shape.points[shape.points.length - 1].y);
                        context.closePath();
                        break;
                }

                context.strokeStyle = shape.color;
                context.lineWidth = shape.intensity; // Use the stored intensity value for each shape
                context.stroke();
            });
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function getInkIntensity() {
            return parseInt(document.getElementById("intensitySlider").value);
        }

        // Clear the whiteboard
        var clearBtn = document.getElementById("clearBtn");
        clearBtn.addEventListener("click", clearWhiteboard);

        function clearWhiteboard() {
            shapes = [];
            redraw();
        }

        // Save the whiteboard as PNG
        var saveBtn = document.getElementById("saveBtn");
        saveBtn.addEventListener("click", saveWhiteboard);

        function saveWhiteboard() {
            var link = document.createElement("a");
            link.href = whiteboard.toDataURL("image/png");
            link.download = "whiteboard.png";
            link.click();
        }

        // Load a saved PNG to the whiteboard
        var loadBtn = document.getElementById("loadBtn");
        loadBtn.addEventListener("change", loadWhiteboard);

        function loadWhiteboard() {
            var file = loadBtn.files[0];
            var reader = new FileReader();

            reader.onload = function (event) {
                var img = new Image();
                img.onload = function () {
                    context.clearRect(0, 0, whiteboard.width, whiteboard.height);
                    context.drawImage(img, 0, 0);
                };
                img.src = event.target.result;
            };

            reader.readAsDataURL(file);
        }

        // Undo the last drawn shape
        var undoBtn = document.getElementById("undoBtn");
        undoBtn.addEventListener("click", undoShape);

        function undoShape() {
            shapes.pop();
            redraw();
        }

        // Select a shape button
        var shapeButtons = document.querySelectorAll(".shapeButton");
        shapeButtons.forEach(button => {
            button.addEventListener("click", selectShape);
        });

        function selectShape(e) {
            shapeButtons.forEach(button => {
                button.classList.remove("selected");
            });

            selectedShapeButton = e.target.closest(".shapeButton");
            selectedShapeButton.classList.add("selected");
        }
    </script>
</body>

</html>